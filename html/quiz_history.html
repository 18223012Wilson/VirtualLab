<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Riwayat Quiz ‚Äî Virtual Lab</title>
    <link rel="stylesheet" href="../css/style.css">
</head>
<body>
    <header>
        <div class="header-content">
            <h1>Virtual Lab: Fisika</h1>
            <nav>
                <a href="home.html"><button id="nav-home">Beranda</button></a>
                <a href="quiz.html"><button id="nav-quiz">Quiz</button></a>
                <a href="profile.html"><button id="nav-profile">Profil</button></a>
                <button id="logoutBtn">Logout</button>
            </nav>
        </div>
    </header>

    <main class="history-container">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--spacing-xl);">
            <div>
                <h2 class="lab-title">Riwayat Quiz</h2>
                <p class="lab-subtitle">Lihat semua hasil quiz yang pernah Anda kerjakan</p>
            </div>
            <button class="btn export-btn" id="exportBtn">
                üì• Export Hasil
            </button>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon">üìù</div>
                <div class="stat-value" id="totalQuizzes">0</div>
                <div class="stat-label">Total Quiz</div>
            </div>

            <div class="stat-card">
                <div class="stat-icon">üìä</div>
                <div class="stat-value" id="avgScore">0%</div>
                <div class="stat-label">Rata-rata Nilai</div>
            </div>

            <div class="stat-card">
                <div class="stat-icon">‚≠ê</div>
                <div class="stat-value" id="bestScore">0%</div>
                <div class="stat-label">Nilai Terbaik</div>
            </div>

            <div class="stat-card">
                <div class="stat-icon">‚úÖ</div>
                <div class="stat-value" id="passRate">0%</div>
                <div class="stat-label">Tingkat Kelulusan</div>
            </div>
        </div>

        <div class="filters">
            <div class="filter-group">
                <label for="filterQuiz">Filter Quiz</label>
                <select id="filterQuiz">
                    <option value="all">Semua Quiz</option>
                    <option value="Quiz Hukum Newton">Quiz Hukum Newton</option>
                    <option value="Quiz Gerak Parabola">Quiz Gerak Parabola</option>
                    <option value="Quiz Penjumlahan Vektor">Quiz Penjumlahan Vektor</option>
                </select>
            </div>

            <div class="filter-group">
                <label for="filterPeriod">Periode</label>
                <select id="filterPeriod">
                    <option value="all">Semua Waktu</option>
                    <option value="today">Hari Ini</option>
                    <option value="week">Minggu Ini</option>
                    <option value="month">Bulan Ini</option>
                </select>
            </div>

            <div class="filter-group">
                <label for="sortBy">Urutkan</label>
                <select id="sortBy">
                    <option value="newest">Terbaru</option>
                    <option value="oldest">Terlama</option>
                    <option value="highest">Nilai Tertinggi</option>
                    <option value="lowest">Nilai Terendah</option>
                </select>
            </div>
        </div>

        <div id="historyList" class="history-list"></div>

        <div id="noData" class="no-data" style="display: none;">
            <div class="icon">üì≠</div>
            <h3>Belum Ada Riwayat Quiz</h3>
            <p>Mulai kerjakan quiz untuk melihat riwayat hasil Anda</p>
            <a href="quiz.html"><button class="btn">Mulai Quiz</button></a>
        </div>
    </main>

    <footer>
        <p>Virtual Lab: Fisika</p>
    </footer>

    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="../js/auth.js"></script>
    <script src="../js/user_data.js"></script>
    <script src="../js/quiz_history.js"></script>
    
    <script>
        VirtualLabAuth.requireAuth();
        
        const logoutBtn = document.getElementById('logoutBtn');
        if (logoutBtn) {
            logoutBtn.addEventListener('click', async () => {
                const confirmed = confirm('Apakah Anda yakin ingin logout?');
                if (!confirmed) return;
                
                logoutBtn.disabled = true;
                logoutBtn.textContent = 'Logging out...';
                
                try {
                    const result = await VirtualLabAuth.logout();
                    if (result.success) {
                        window.location.href = 'login.html';
                    }
                } catch (error) {
                    console.error('Logout error:', error);
                    alert('Gagal logout. Silakan coba lagi.');
                    logoutBtn.disabled = false;
                    logoutBtn.textContent = 'Logout';
                }
            });
        }
    </script>
</body>
</html>